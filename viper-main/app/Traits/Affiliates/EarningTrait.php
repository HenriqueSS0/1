<?php
 namespace App\Traits\Affiliates; use App\Models\AffiliateHistory; use App\Models\Order; use App\Models\User; use App\Models\Wallet; trait EarningTrait { public static function affiliateRevshare(User $u) { $afh = AffiliateHistory::where("\151\x6e\x76\x69\164\x65\x72", $u->id)->where("\x63\157\x6d\155\151\x73\x73\x69\x6f\x6e\137\x74\171\160\x65", "\162\x65\166\163\x68\x61\x72\x65")->where("\x73\x74\141\164\165\163", 0)->get(); if (count($afh) > 0) { foreach ($afh as $affh) { if ($affh->losses_amount >= $affh->deposited_amount) { $g = \Helper::porcentagem_xn($affh->commission, $affh->losses_amount); $w = Wallet::where("\165\x73\145\x72\x5f\x69\144", $u->id)->first(); $w->increment("\x72\145\146\145\162\x5f\162\145\167\x61\162\x64\163", $g); } } } } public static function affiliateCpa(User $u) { $afh = AffiliateHistory::where("\x69\x6e\166\x69\x74\145\162", $u->id)->where("\143\x6f\x6d\x6d\x69\x73\163\151\157\x6e\137\164\x79\x70\145", "\143\x70\141")->where("\163\x74\141\x74\x75\x73", 0)->get(); if (count($afh) > 0) { foreach ($afh as $affh) { if ($affh->losses_amount >= $affh->deposited_amount) { $w = Wallet::where("\165\x73\145\162\137\151\144",$u->id)->first();$w->increment("\162\x65\146\145\x72\x5f\162\145\x77\x61\162\x64\x73",$u->affiliate_cpa);}}}}}